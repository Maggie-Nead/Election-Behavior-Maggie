---
title: "Models"
author: "Maggie Nead"
date: "7/13/2020"
output: html_document
---

```{r setup, include=FALSE}
source(here::here("setup.R"))
source(here::here("dataSetup.R"))
```

```{r dataFilter}
d <- data %>%
  filter(!is.na(TYPE))

d %>%
group_by(TYPE) %>%
tally

d %<>%
  mutate(interest = ifelse(TYPE %in% c(1), "constituent", NA)) %>%
  mutate(interest = ifelse(TYPE %in% c(2,4), "corporate", interest))# %>%
  #mutate(interest = ifelse(! str_detect(TYPE, "1|2|4"), "neither", interest))



d %>%
  group_by(interest) %>%
  tally()



d %<>%
  count(bioname, icpsr, congress, reelections, party_name, interest, name = "lettersPerInterest")
 
d %<>% 
  mutate(corporateInterest = ifelse(str_detect(interest, "corporate"), lettersPerInterest, 0)) %>%
  mutate(constituentInterest = ifelse(str_detect(interest, "constituent"), lettersPerInterest, 0))


```

```{r plots}
d %>%
  ggplot(aes(x=corporateInterest, y=reelections)) + 
  geom_point(outlier.colour="black", outlier.shape=16,
               outlier.size=2, notch=TRUE) 

d %>%
  ggplot(aes(x=constituentInterest, y=reelections)) + 
  geom_point(outlier.colour="black", outlier.shape=16,
               outlier.size=2, notch=TRUE) 

```


#1 corporate, 2 constituent
```{r countModel1, fig.height=1}
#d$interest <- ordered(d$interest, levels = c("neither", "corporate", "constituent"))

countModel <- glm(reelections ~ corporateInterest + constituentInterest, 
            data = d,  #%>% distinct(), 
            #contrasts = list(interest = contr.sum(2)),
         family = poisson)  

summary(countModel)


ggplot(countModel, aes(seq_along(.cooksd), .cooksd)) +
  geom_col()

```


```{r countModel2}
countModel2 <- lm(reelections ~ corporateInterest + constituentInterest, 
            data = d  %>% distinct())  

summary(countModel2)
```


```{r partyModel}
#d$party_name <- ordered(d$party_name, levels = c("Independent", "Democratic", "Republican"))
partyModel <- glm(reelections ~ corporateInterest*party_name + constituentInterest*party_name, 
            data = d  %>% distinct(), 
         family = poisson)  

summary(partyModel)
```


```{r partyModel2}
partyModel2 <- lm(reelections ~ corporateInterest*party_name + constituentInterest*party_name, 
            data = d  %>% distinct())  


summary(partyModel2)


```



